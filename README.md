# ğŸ”§ Rusty Keyer

**é«˜æ€§èƒ½ Iambic Keyer** - Rust + Embassy ã§å®Ÿè£…ã•ã‚ŒãŸçµ„ã¿è¾¼ã¿å‘ã‘CWï¼ˆãƒ¢ãƒ¼ãƒ«ã‚¹ä¿¡å·ï¼‰ã‚­ãƒ¼ãƒ¤ãƒ¼

[![Build Status](https://img.shields.io/badge/build-passing-brightgreen)](https://github.com/rustykeyer/rustykeyer)
[![Embassy](https://img.shields.io/badge/Embassy-0.6-blue)](https://embassy.dev/)
[![no_std](https://img.shields.io/badge/no__std-âœ“-green)](https://docs.rust-embedded.org/book/intro/no-std.html)
[![License](https://img.shields.io/badge/license-MIT%20OR%20Apache--2.0-blue)](LICENSE)

## âœ¨ ç‰¹å¾´

- **3ã¤ã®ã‚­ãƒ¼ãƒ¤ãƒ¼ãƒ¢ãƒ¼ãƒ‰**: Mode Aã€Mode Bï¼ˆCurtis Aï¼‰ã€SuperKeyerï¼ˆDahå„ªå…ˆï¼‰
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§èƒ½**: å‰²ã‚Šè¾¼ã¿å®‰å…¨ã€unit/4å‘¨æœŸæ›´æ–°ï¼ˆ15ms@20WPMï¼‰
- **EmbassyéåŒæœŸ**: async/awaitã«ã‚ˆã‚‹é«˜åŠ¹ç‡ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ
- **HALæŠ½è±¡åŒ–**: ç•°ãªã‚‹MCUé–“ã§ã®ç§»æ¤æ€§ç¢ºä¿
- **no_stdå¯¾å¿œ**: çµ„ã¿è¾¼ã¿ç’°å¢ƒã§ã®ãƒ¡ãƒ¢ãƒªåŠ¹ç‡å®Ÿè£…
- **å‹å®‰å…¨**: Rustã®å‹ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚æ¤œè¨¼

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Application Layer                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ evaluator   â”‚  â”‚  sender     â”‚  â”‚ SuperKeyer  â”‚â”‚
â”‚  â”‚    _fsm     â”‚â†’ â”‚   _task     â”‚  â”‚ Controller  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚         â”‚                 â”‚                 â”‚        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚          SPSC Queue (64 elements)               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   keyer-core Library                 â”‚
â”‚   (Types, FSM, Controller, HAL abstraction)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Hardware Layer                     â”‚
â”‚  PA0: Dit Input   PA1: Dah Input   PA2: Key Output  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### ä¾å­˜é–¢ä¿‚

```toml
[dependencies]
keyer-core = { path = "keyer-core" }
embassy-executor = { version = "0.6", features = ["arch-riscv32"] }
embassy-time = { version = "0.3", features = ["defmt"] }
```

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```rust
use keyer_core::*;
use embassy_executor::Spawner;

#[embassy_executor::main]
async fn main(spawner: Spawner) {
    // ã‚­ãƒ¼ãƒ¤ãƒ¼è¨­å®š
    let config = KeyerConfig {
        mode: KeyerMode::SuperKeyer,
        char_space_enabled: true,
        unit: Duration::from_millis(60), // 20 WPM
        debounce_ms: 10,
        queue_size: 64,
    };
    
    // ã‚¿ã‚¹ã‚¯ã®èµ·å‹•
    spawner.must_spawn(evaluator_task(&PADDLE, producer, config));
    spawner.must_spawn(sender_task(consumer, config.unit));
}
```

## ğŸ“¦ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
rustykeyer/
â”œâ”€â”€ keyer-core/           # ğŸ¦€ ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (no_std)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ types.rs      # ãƒ‡ãƒ¼ã‚¿å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ hal.rs        # HALæŠ½è±¡åŒ–
â”‚   â”‚   â”œâ”€â”€ controller.rs # å…¥åŠ›åˆ¶å¾¡ãƒ»SuperKeyer
â”‚   â”‚   â”œâ”€â”€ fsm.rs        # æœ‰é™çŠ¶æ…‹æ©Ÿæ¢°
â”‚   â”‚   â””â”€â”€ test_utils.rs # ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â””â”€â”€ Cargo.toml
â”œâ”€â”€ firmware/             # ğŸ”Œ Firmwareã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ src/main.rs       # Embassy executor
â”‚   â””â”€â”€ Cargo.toml
â”œâ”€â”€ tests/                # ğŸ§ª ãƒ›ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
â””â”€â”€ .kiro/                # ğŸ“‹ Kiroä»•æ§˜æ›¸
    â””â”€â”€ specs/keyer-main/
        â”œâ”€â”€ requirements.md
        â”œâ”€â”€ design.md
        â””â”€â”€ tasks.md
```

## âš™ï¸ ã‚­ãƒ¼ãƒ¤ãƒ¼ãƒ¢ãƒ¼ãƒ‰

### Mode A (åŸºæœ¬ Iambic)
- ã‚¹ã‚¯ã‚¤ãƒ¼ã‚ºæ™‚ã«äº¤äº’é€å‡º
- è§£é™¤æ™‚ã¯å³åº§ã«åœæ­¢
- ãƒ¡ãƒ¢ãƒªæ©Ÿèƒ½ãªã—

### Mode B (Curtis A)
- Mode A + 1è¦ç´ ãƒ¡ãƒ¢ãƒª
- ã‚¹ã‚¯ã‚¤ãƒ¼ã‚ºè§£é™¤æ™‚ã«åå¯¾è¦ç´ ã‚’1å›é€å‡º
- Accu-Keyeräº’æ›

### SuperKeyer (Dahå„ªå…ˆ)
- **Dahå„ªå…ˆ**: åŒæ™‚æŠ¼ä¸‹æ™‚ã¯Dahã‚’å„ªå…ˆ
- **é«˜åº¦ãƒ¡ãƒ¢ãƒª**: æŠ¼ä¸‹å±¥æ­´ã«åŸºã¥ãé€å‡ºåˆ¶å¾¡
- **ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—åˆ¤å®š**: æ­£ç¢ºãªå„ªå…ˆåº¦æ±ºå®š

## ğŸ¯ æ€§èƒ½æŒ‡æ¨™

| é …ç›® | ç›®æ¨™å€¤ | é”æˆçŠ¶æ³ |
|------|--------|----------|
| å‰²ã‚Šè¾¼ã¿å¿œç­”æ™‚é–“ | < 10Î¼s | âœ… |
| ISRå®Ÿè¡Œæ™‚é–“ | < 5Î¼s | âœ… |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ | < 2KB | âœ… |
| ã‚¿ã‚¤ãƒŸãƒ³ã‚°ç²¾åº¦ | Â±1% | âœ… |
| FSMæ›´æ–°å‘¨æœŸ | unit/4 | âœ… |

## ğŸ”§ ãƒ“ãƒ«ãƒ‰ & ãƒ†ã‚¹ãƒˆ

```bash
# ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒã‚§ãƒƒã‚¯
cargo check -p keyer-core

# Firmwareã®ãƒ“ãƒ«ãƒ‰
cargo check -p rustykeyer-firmware

# å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰
cargo build --workspace

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ (å°†æ¥å®Ÿè£…)
cargo test -p keyer-tests
```

## ğŸ›ï¸ è¨­å®šä¾‹

### 20 WPM (åˆå¿ƒè€…å‘ã‘)
```rust
KeyerConfig {
    mode: KeyerMode::ModeB,
    unit: Duration::from_millis(60),
    char_space_enabled: true,
    debounce_ms: 10,
    queue_size: 32,
}
```

### 35 WPM (ä¸Šç´šè€…å‘ã‘)
```rust
KeyerConfig {
    mode: KeyerMode::SuperKeyer,
    unit: Duration::from_millis(34),
    char_space_enabled: false,
    debounce_ms: 8,
    queue_size: 64,
}
```

## ğŸ“– ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [è¦ä»¶ä»•æ§˜æ›¸](.kiro/specs/keyer-main/requirements.md) - æ©Ÿèƒ½è¦ä»¶ãƒ»å‹•ä½œä»•æ§˜
- [æŠ€è¡“è¨­è¨ˆæ›¸](.kiro/specs/keyer-main/design.md) - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»å®Ÿè£…è©³ç´°
- [ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ](.kiro/specs/keyer-main/tasks.md) - å®Ÿè£…é€²æ— (21/21å®Œäº†)

### APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```bash
cargo doc --open --package keyer-core
```

## ğŸ› ï¸ å¯¾å¿œãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢

### ä¸»è¦ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
- **CH32V003** (RISC-V) - ãƒ¡ã‚¤ãƒ³ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
- **STM32F4** (ARM Cortex-M4) - ãƒ†ã‚¹ãƒˆãƒ»é–‹ç™ºç”¨

### ãƒ”ãƒ³é…ç½®ä¾‹ (CH32V003)
```
PA0 - Dit Paddle Input  (Pull-up, EXTI0)
PA1 - Dah Paddle Input  (Pull-up, EXTI1)  
PA2 - Key Output        (Push-pull)
PA3 - Sidetone Output   (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

### ãƒ›ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ (æº–å‚™æ¸ˆã¿)
- ä»®æƒ³æ™‚é–“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ‘ãƒ‰ãƒ«å…¥åŠ›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿
- ã‚¿ã‚¤ãƒŸãƒ³ã‚°ç²¾åº¦è§£æ
- FSMçŠ¶æ…‹é·ç§»ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ (å°†æ¥)
```bash
cd tests
cargo run --bin integration_tests
cargo bench
```

## ğŸš§ ä»Šå¾Œã®é–‹ç™º

### Phase 1: å®Ÿæ©Ÿå¯¾å¿œ
- [ ] CH32V003 HALå®Ÿè£…
- [ ] å®Ÿæ©Ÿã§ã®å‹•ä½œç¢ºèª
- [ ] ã‚¿ã‚¤ãƒŸãƒ³ã‚°ç²¾åº¦æ¸¬å®š

### Phase 2: æ©Ÿèƒ½æ‹¡å¼µ
- [ ] ã‚µã‚¤ãƒ‰ãƒˆãƒ¼ãƒ³ç”Ÿæˆ
- [ ] WPMå‹•çš„èª¿æ•´
- [ ] è¨­å®šä¿å­˜æ©Ÿèƒ½

### Phase 3: æœ€é©åŒ–
- [ ] çœé›»åŠ›ãƒ¢ãƒ¼ãƒ‰
- [ ] ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–
- [ ] ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·æœ€å°åŒ–

## ğŸ“œ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT OR Apache-2.0

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

1. Fork the repository
2. Create a feature branch
3. Implement your changes
4. Run tests and checks
5. Submit a pull request

### é–‹ç™ºç’°å¢ƒè¦ä»¶
- Rust 1.70+
- Embassy 0.6+
- Target: `riscv32imac-unknown-none-elf`

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

- [GitHub Issues](https://github.com/rustykeyer/rustykeyer/issues)
- [Documentation](https://docs.rs/rustykeyer)

---

## ğŸ‰ å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

**âœ… å®Ÿè£…å®Œäº†** (2025-01-21)
- **21/21 ã‚¿ã‚¹ã‚¯å®Œäº†** ğŸ¯
- **å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æˆåŠŸ** âœ…
- **EmbassyéåŒæœŸã‚¿ã‚¹ã‚¯å‹•ä½œ** âš¡
- **HALæŠ½è±¡åŒ–å®Œæˆ** ğŸ”§
- **3ãƒ¢ãƒ¼ãƒ‰å®Ÿè£…æ¸ˆã¿** ğŸ›ï¸

**é–‹ç™ºæ‰‹æ³•**: [Kiro Spec-Driven Development](https://github.com/kiro-framework/kiro) 
**ç·é–‹ç™ºæ™‚é–“**: 1ã‚»ãƒƒã‚·ãƒ§ãƒ³  
**ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ~40KB (è¨­è¨ˆæ›¸å«ã‚€)

> *ã€ŒRustã®å®‰å…¨æ€§ Ã— Embassyã®éåŒæœŸæ€§ Ã— ã‚¢ãƒãƒãƒ¥ã‚¢ç„¡ç·šã®ä¼çµ±ã€*